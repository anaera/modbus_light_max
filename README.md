# modbus_light_max
Всего программа поддерживает 64 порта входа/выхода. 
Порты конфигурируются группами по 8 входов или выходов. 

Каждый вход может быть сконфигурирован как кнопка с контролем длительности нажатия или как вход контроля активности (смены логического уровня - перехода между 0 и 1).
Каждый вход может быть связан с любыми двумя выходами, вызывая их включение и выключение в соответствием со своей функциональностью - кнопка или контроль активности.

Каждый вход при изменении уровня может генерировать четыре  состояния - изменение уровня, короткое нажатие/отпускание, длинное нажатие/отпускание, повторение нажатие/отпускание.
Входы сконфигурированные как кнопки пропускают на активацию связанных с ними выходов только состояния короткого/длинного нажатия.
А выходы контроля уровня - только состояния изменения уровня.

В стандартной конфигурации для автоматизировванного управления светом программа поддерживает 16 отдельно конфигурируемых выходов и 48 отдельно конфигурируемых входов. Стандартно входы разбиваются на три функциональные группы (не обязательно). Шестнадцать кнопок включения/выключения, 16 входов контроля активности датчиков движения и 16 входов датчиков активности дверей, которые связываются с соответствующими 16 выходами. 

При необходимости количество выходов может быть увеличено добавлением следующего контроллера. При этом часть входов/выходов каждого из них может использоваться для поддержки связного управления для пограничных между ними помещений.

Вариант управления с учетом длительности нажатия кнопок

1- длительное нажатие при включенном (coil) свете - устанавливает флаг ручного управления (manual) данным (coil) лампой. В этом режиме датчики движения и датчики двери не управляют этим (coil) выходом. Работает только кнопка включения/выключения.

2- длительное нажатие при выключенном выходе(coil) сбрасывает флаг ручного управления выходами (светом). Выход переходит в режим автоматического управления светом.   В этом режиме свет включается по датчику двери и поддерживается при каждой активности датчика движения на заданное время. При отсутствии активности датчик движения в течении установленного времени выход переводится в неактивное состояние (выключается).
В автоматическом режиме работы выхода:

3 - при коротком нажатии при включенном свете, выход выключается и активность датчиков двери и движения блокируется на заданное время, что дает возможность покинуть комнату не активируя (включая свет) выход активностью двери и датчика движения. Повторное нажатие на кнопки включения - включает свет. Т.е. активность кнопки вкл/выкл не блокируется.

4 - при коротком нажатии при выключенном свете, выход принудительно включается. В дальнейшем управляется активностью датчика движения.

Каждое устройство имеет свой modbus адрес. Состояние входов мжет быть прочинано фукциями ReadInput, а выходов readCoil. Состояние выходов изменяются функциями writeCoil. При изменении выходов со стороны хоста должно полностью контролироваться и управляться хостом.
